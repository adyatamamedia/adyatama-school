<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Click Issues</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/vendor/summernote/css/summernote-bs5.min.css" rel="stylesheet">

    <style>
        body {
            padding: 20px;
        }
        .debug-panel {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .event-log {
            height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ced4da;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
        }

        /* Aggressive CSS fixes */
        * {
            pointer-events: auto !important;
        }

        .note-editor {
            position: relative !important;
            z-index: 999999 !important;
        }

        .note-editor * {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative !important;
            z-index: inherit !important;
        }

        .note-editor .note-btn {
            pointer-events: auto !important;
            cursor: pointer !important;
            z-index: 999999 !important;
            background: yellow !important;
            border: 2px solid red !important;
        }

        .note-editor .note-editable {
            pointer-events: auto !important;
            cursor: text !important;
            z-index: 999999 !important;
        }

        /* Hide potential overlays */
        .modal-backdrop,
        .overlay,
        .fade {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Debug Click Issues</h1>

        <div class="debug-panel">
            <h3>Step 1: Raw Summernote Test</h3>
            <textarea id="summernote1">Test content here</textarea>
            <button class="btn btn-primary" onclick="testDirectAPI()">Test Direct API</button>
        </div>

        <div class="debug-panel">
            <h3>Step 2: Event Log</h3>
            <div id="event-log" class="event-log">Event log will appear here...</div>
            <button class="btn btn-secondary" onclick="clearLog()">Clear Log</button>
        </div>

        <div class="debug-panel">
            <h3>Step 3: Manual Click Test</h3>
            <button id="test-button1" class="btn btn-warning">Test Button 1 (Should Log Click)</button>
            <button id="test-button2" class="btn btn-danger">Test Button 2 (Should Alert)</button>
        </div>

        <div class="debug-panel">
            <h3>Step 4: Summernote with Aggressive Fixes</h3>
            <textarea id="summernote2">Try to click buttons here</textarea>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/vendor/summernote/js/summernote-bs5.min.js"></script>

    <script>
        let eventCount = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌' : type === 'success' ? '✅' : 'ℹ️';
            logDiv.innerHTML += `[${timestamp}] ${prefix} ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            eventCount++;
        }

        function clearLog() {
            document.getElementById('event-log').innerHTML = '';
            eventCount = 0;
        }

        // Test 1: Basic button functionality
        $(document).ready(function() {
            log('Document ready', 'success');

            // Test basic jQuery
            log('jQuery version: ' + $.fn.jquery);

            // Test Summernote
            log('Summernote available: ' + (typeof $.fn.summernote !== 'undefined'));

            // Test manual buttons
            $('#test-button1').on('click', function() {
                log('Test Button 1 clicked - jQuery event working!', 'success');
            });

            document.getElementById('test-button2').addEventListener('click', function() {
                log('Test Button 2 clicked - Native event working!', 'success');
                alert('Button 2 clicked successfully!');
            });
        });

        // Test 2: Initialize first Summernote
        function initFirstSummernote() {
            try {
                $('#summernote1').summernote({
                    height: 200,
                    callbacks: {
                        onInit: function() {
                            log('First Summernote initialized', 'success');
                            setupButtonTests();
                        }
                    }
                });
            } catch (error) {
                log('Error initializing first Summernote: ' + error.message, 'error');
            }
        }

        // Test 3: Setup button testing
        function setupButtonTests() {
            setTimeout(function() {
                log('Setting up button tests...');

                // Test all possible button selectors
                const selectors = [
                    '.note-btn',
                    '.note-editor .note-btn',
                    '.note-toolbar .note-btn',
                    '.note-editor button',
                    'button'
                ];

                selectors.forEach(selector => {
                    const buttons = $(selector);
                    log(`Found ${buttons.length} elements with selector: ${selector}`);

                    // Add multiple types of event listeners
                    buttons.each(function(index) {
                        const $btn = $(this);

                        // jQuery click
                        $btn.on('click.debug', function(e) {
                            log(`jQuery Click: ${selector}[${index}] - ${e.type}`, 'success');
                        });

                        // Native click
                        this.addEventListener('click', function(e) {
                            log(`Native Click: ${selector}[${index}]`, 'success');
                        });

                        // Mousedown
                        $btn.on('mousedown.debug', function(e) {
                            log(`MouseDown: ${selector}[${index}]`, 'info');
                        });

                        // Mouseup
                        $btn.on('mouseup.debug', function(e) {
                            log(`MouseUp: ${selector}[${index}]`, 'info');
                        });

                        // Touch events for mobile
                        $btn.on('touchstart.debug', function(e) {
                            log(`TouchStart: ${selector}[${index}]`, 'info');
                        });

                        $btn.on('touchend.debug', function(e) {
                            log(`TouchEnd: ${selector}[${index}]`, 'success');
                        });
                    });
                });

                // Test specific bold button
                const boldBtn = $('.note-btn[data-event="bold"]');
                if (boldBtn.length > 0) {
                    log(`Found ${boldBtn.length} bold buttons`);

                    // Try multiple approaches to make it work
                    boldBtn.css({
                        'pointer-events': 'auto !important',
                        'cursor': 'pointer !important',
                        'z-index': '999999 !important'
                    });

                    // Force enable pointer events
                    boldBtn[0].style.pointerEvents = 'auto';
                    boldBtn[0].style.cursor = 'pointer';
                }

            }, 2000);
        }

        // Test 4: Direct API test
        function testDirectAPI() {
            try {
                // Try to format text directly
                $('#summernote1').summernote('bold');
                log('Direct API bold command executed', 'success');

                // Insert content
                $('#summernote1').summernote('insertText', ' - This was inserted via API');
                log('Text inserted via API', 'success');

            } catch (error) {
                log('API test failed: ' + error.message, 'error');
            }
        }

        // Test 5: Initialize second Summernote with minimal config
        function initSecondSummernote() {
            try {
                $('#summernote2').summernote({
                    height: 200,
                    toolbar: [
                        ['style', ['bold', 'italic', 'underline']],
                        ['para', ['ul', 'ol']]
                    ],
                    callbacks: {
                        onInit: function() {
                            log('Second Summernote initialized', 'success');

                            // Test direct button triggering
                            setTimeout(function() {
                                log('Testing direct button triggering...');
                                $('.note-btn[data-event="bold"]').first().trigger('click');
                                log('Bold button triggered programmatically', 'success');
                            }, 3000);
                        }
                    }
                });
            } catch (error) {
                log('Error initializing second Summernote: ' + error.message, 'error');
            }
        }

        // Initialize everything
        $(document).ready(function() {
            setTimeout(initFirstSummernote, 500);
            setTimeout(initSecondSummernote, 2000);
        });

        // Global click catcher
        document.addEventListener('click', function(e) {
            if (eventCount > 100) return; // Prevent too many logs

            log(`Global click detected: ${e.target.tagName} - ${e.target.className}`, 'info');
        }, true);

        // Test for overlay prevention
        setInterval(function() {
            const overlays = document.querySelectorAll('.modal-backdrop, .overlay, [style*="position: fixed"]');
            if (overlays.length > 0) {
                log(`Found ${overlays.length} potential overlays blocking clicks`, 'error');
                overlays.forEach((overlay, index) => {
                    overlay.style.display = 'none';
                    log(`Hid overlay ${index}`, 'success');
                });
            }
        }, 3000);
    </script>
</body>
</html>