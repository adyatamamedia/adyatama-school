<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summernote Clickability Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/dash/assets/vendor/summernote/css/summernote-bs5.min.css" rel="stylesheet">

    <style>
        body {
            padding: 20px;
            background: #f8f9fa;
        }

        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Apply the same CSS fixes as in the main layout */
        .note-editor * {
            pointer-events: auto !important;
        }

        .note-editor .note-editable {
            cursor: text !important;
        }

        .note-editor .note-btn {
            cursor: pointer !important;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            position: relative;
            z-index: 1002;
        }

        .note-editor .note-btn:hover {
            background: #e9ecef !important;
        }

        .note-editor .note-dropdown-menu {
            z-index: 99999 !important;
        }

        .note-editor {
            position: relative;
            z-index: 1000;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Summernote Clickability Test</h1>

        <div class="test-container">
            <h3>Dependencies Status</h3>
            <div id="dependency-status">
                <div class="status info">Checking dependencies...</div>
            </div>
        </div>

        <div class="test-container">
            <h3>Summernote Editor Test</h3>
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Try to click on the toolbar buttons (B, I, U, etc.)</li>
                <li>Try to type in the editor area</li>
                <li>Try to use dropdown menus</li>
                <li>Check the test results below</li>
            </ol>

            <div class="form-group">
                <label for="summernote">Test Editor:</label>
                <textarea id="summernote" class="form-control" name="content">Start typing here...</textarea>
            </div>

            <div class="row mt-3">
                <div class="col-md-6">
                    <button class="btn btn-primary" onclick="testButtons()">Test Buttons</button>
                    <button class="btn btn-success" onclick="testTyping()">Test Typing</button>
                    <button class="btn btn-info" onclick="testDropdowns()">Test Dropdowns</button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-warning" onclick="clearEditor()">Clear</button>
                    <button class="btn btn-secondary" onclick="resetTest()">Reset Test</button>
                </div>
            </div>
        </div>

        <div class="test-container">
            <h3>Test Results</h3>
            <div id="test-results">
                <div class="status info">Run tests above to see results...</div>
            </div>
        </div>

        <div class="test-container">
            <h3>Console Log</h3>
            <pre id="console-log" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px;"></pre>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/dash/assets/vendor/summernote/js/summernote-bs5.min.js"></script>

    <script>
        // Console log capture
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addToConsole(type, ...args) {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg =>
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');

            logDiv.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('log', ...args);
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('error', ...args);
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('warn', ...args);
        };

        // Check dependencies
        function checkDependencies() {
            const status = document.getElementById('dependency-status');
            let html = '';

            const checks = [
                { name: 'jQuery', check: typeof $ !== 'undefined' },
                { name: 'Bootstrap', check: typeof bootstrap !== 'undefined' },
                { name: 'Summernote', check: typeof $.fn.summernote !== 'undefined' }
            ];

            checks.forEach(item => {
                const statusClass = item.check ? 'success' : 'error';
                const icon = item.check ? '✓' : '✗';
                html += `<div class="status ${statusClass}">${icon} ${name}: ${item.check ? 'LOADED' : 'NOT LOADED'}</div>`;
            });

            status.innerHTML = html;
        }

        // Initialize Summernote
        function initSummernote() {
            if (typeof $ !== 'undefined' && typeof $.fn.summernote !== 'undefined') {
                $('#summernote').summernote({
                    height: 300,
                    placeholder: 'Test typing here...',
                    toolbar: [
                        ['style', ['style']],
                        ['font', ['bold', 'italic', 'underline', 'clear']],
                        ['fontname', ['fontname']],
                        ['color', ['color']],
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['table', ['table']],
                        ['insert', ['link', 'picture', 'video']],
                        ['view', ['fullscreen', 'codeview', 'help']]
                    ],
                    callbacks: {
                        onInit: function() {
                            console.log('✓ Summernote initialized successfully');
                            addTestResult('success', 'Summernote initialized successfully');
                        },
                        onFocus: function() {
                            console.log('✓ Editor focused');
                        },
                        onBlur: function() {
                            console.log('✓ Editor blurred');
                        },
                        onKeyup: function(e) {
                            console.log('✓ Key pressed:', e.keyCode);
                        }
                    }
                });
            }
        }

        // Test functions
        function addTestResult(type, message) {
            const results = document.getElementById('test-results');
            const statusClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            const icon = type === 'success' ? '✓' : type === 'error' ? '✗' : 'ℹ';

            const html = `<div class="status ${statusClass}">${icon} ${message}</div>`;
            results.innerHTML = html + results.innerHTML;
        }

        function testButtons() {
            console.log('Testing buttons...');
            const buttons = $('.note-editor .note-btn');

            if (buttons.length === 0) {
                addTestResult('error', 'No buttons found');
                return;
            }

            addTestResult('success', `Found ${buttons.length} toolbar buttons`);

            // Test clicking a button
            const boldButton = $('.note-editor .note-btn[data-event="bold"]').first();
            if (boldButton.length > 0) {
                boldButton.trigger('click');
                addTestResult('success', 'Bold button clicked successfully');
            } else {
                addTestResult('error', 'Bold button not found');
            }
        }

        function testTyping() {
            console.log('Testing typing...');
            const editable = $('.note-editor .note-editable');

            if (editable.length === 0) {
                addTestResult('error', 'Editable area not found');
                return;
            }

            editable.focus();
            editable.html('Test typing - this should appear in the editor!');
            addTestResult('success', 'Text inserted successfully');
        }

        function testDropdowns() {
            console.log('Testing dropdowns...');
            const dropdowns = $('.note-editor .note-dropdown-toggle');

            if (dropdowns.length === 0) {
                addTestResult('error', 'No dropdowns found');
                return;
            }

            addTestResult('success', `Found ${dropdowns.length} dropdown buttons`);

            // Test clicking first dropdown
            const firstDropdown = dropdowns.first();
            if (firstDropdown.length > 0) {
                firstDropdown.trigger('click');
                addTestResult('success', 'First dropdown clicked successfully');
            }
        }

        function clearEditor() {
            $('#summernote').summernote('code', '');
            addTestResult('info', 'Editor cleared');
        }

        function resetTest() {
            document.getElementById('test-results').innerHTML = '<div class="status info">Run tests above to see results...</div>';
            document.getElementById('console-log').textContent = '';
            console.log('Test reset');
        }

        // Initialize on document ready
        $(document).ready(function() {
            console.log('Document ready');
            checkDependencies();

            setTimeout(function() {
                initSummernote();
            }, 100);
        });
    </script>
</body>
</html>