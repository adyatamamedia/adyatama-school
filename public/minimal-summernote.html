<!DOCTYPE html>
<html>
<head>
    <title>Minimal Summernote Test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs5.min.css" rel="stylesheet">

    <style>
        /* Force all to be clickable */
        * {
            pointer-events: auto !important;
        }

        .note-editor * {
            pointer-events: auto !important;
            cursor: pointer !important;
        }

        .note-editor .note-btn {
            background: #f0f0f0 !important;
            border: 1px solid #ccc !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }

        .note-editor .note-btn:hover {
            background: #e0e0e0 !important;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <h1>Minimal Summernote Test</h1>

    <div class="alert alert-info">
        <h5>Instructions:</h5>
        <ol>
            <li>Try to click the B (Bold) button below</li>
            <li>Try to type in the text area</li>
            <li>Check the console for messages</li>
        </ol>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Test Editor</h5>
            <textarea id="summernote">Hello World!</textarea>

            <div class="mt-3">
                <button class="btn btn-primary" onclick="testAPI()">Test API</button>
                <button class="btn btn-success" onclick="insertBold()">Insert Bold Text</button>
                <button class="btn btn-info" onclick="checkButtons()">Check Buttons</button>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h5>Console Output:</h5>
        <pre id="output" style="background: #f8f9fa; padding: 10px; border-radius: 5px; min-height: 100px;">Waiting for events...</pre>
    </div>
</div>

<!-- JavaScript Bundle with Popper -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs5.min.js"></script>

<script>
    let messageCount = 0;

    function log(message, type = 'info') {
        const output = document.getElementById('output');
        const timestamp = new Date().toLocaleTimeString();
        const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
        output.textContent = `[${timestamp}] ${icon} ${message}\n` + output.textContent;
        messageCount++;
        console.log(`[SUMMERNOTE TEST] ${message}`);
    }

    // Override console.log
    const originalLog = console.log;
    console.log = function(...args) {
        originalLog.apply(console, args);
        if (args.length > 0 && typeof args[0] === 'string' && args[0].includes('Button clicked')) {
            log(args.join(' '), 'success');
        }
    };

    $(document).ready(function() {
        log('jQuery ready: ' + (typeof $ !== 'undefined'), 'success');
        log('Summernote available: ' + (typeof $.fn.summernote !== 'undefined'), 'success');

        // Initialize Summernote with minimal config
        $('#summernote').summernote({
            height: 200,
            toolbar: [
                ['style', ['bold', 'italic', 'underline']],
                ['font', ['clear']],
                ['para', ['ul', 'ol', 'paragraph']],
            ],
            callbacks: {
                onInit: function() {
                    log('Summernote initialized successfully', 'success');

                    // Add click listeners to buttons
                    setTimeout(function() {
                        setupButtonListeners();
                    }, 1000);
                },
                onChange: function(contents, $editable) {
                    if (messageCount < 50) { // Prevent spam
                        log('Content changed');
                    }
                }
            }
        });
    });

    function setupButtonListeners() {
        log('Setting up button listeners...');

        // Find all buttons
        const buttons = document.querySelectorAll('.note-btn, button');
        log(`Found ${buttons.length} buttons in document`);

        buttons.forEach((button, index) => {
            // Add multiple event listeners
            button.addEventListener('click', function(e) {
                log(`BUTTON CLICKED! Index: ${index}, Event: ${e.target.dataset.event || 'unknown'}`, 'success');
            });

            button.addEventListener('mousedown', function(e) {
                log(`Button mousedown: ${index}`);
            });

            // Force pointer events
            button.style.pointerEvents = 'auto';
            button.style.cursor = 'pointer';
            button.style.position = 'relative';
            button.style.zIndex = '9999';
        });

        // Test specific buttons
        const boldBtn = document.querySelector('[data-event="bold"]');
        if (boldBtn) {
            log('Bold button found, adding special listener');
            boldBtn.addEventListener('click', function(e) {
                log('ðŸ”¥ BOLD BUTTON CLICKED! ðŸ”¥', 'success');
                alert('Bold button works! You clicked it!');
            });
        }

        // Test jQuery events too
        $('.note-btn').on('click', function() {
            log(`jQuery: Button clicked: ${$(this).data('event')}`, 'success');
        });
    }

    function testAPI() {
        try {
            $('#summernote').summernote('bold');
            log('API: Bold command executed', 'success');

            $('#summernote').summernote('italic');
            log('API: Italic command executed', 'success');
        } catch (error) {
            log('API Error: ' + error.message, 'error');
        }
    }

    function insertBold() {
        try {
            $('#summernote').summernote('pasteHTML', '<strong>This text was inserted via API</strong>');
            log('API: Text inserted successfully', 'success');
        } catch (error) {
            log('Insert Error: ' + error.message, 'error');
        }
    }

    function checkButtons() {
        const buttons = document.querySelectorAll('.note-btn');
        log(`Currently ${buttons.length} Summernote buttons found`);

        buttons.forEach((btn, i) => {
            log(`Button ${i}: ${btn.textContent.trim()} (data-event: ${btn.dataset.event || 'none'})`);
        });
    }

    // Global click detector
    document.addEventListener('click', function(e) {
        if (messageCount > 100) return; // Prevent spam

        const target = e.target;
        const tagName = target.tagName;
        const className = target.className;

        if (tagName === 'BUTTON' || className.includes('note-btn')) {
            log(`GLOBAL CLICK: ${tagName} with class: ${className}`, 'success');
        }
    }, true);

</script>

</body>
</html>